# Max Stage Flow Diagram

## Request Flow with max_stage Parameter

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend Dashboard                          â”‚
â”‚  User sets max_stage: "architecture_design"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              POST /v1/public/agent-swarms/orchestrate           â”‚
â”‚                                                                   â”‚
â”‚  Request Body:                                                   â”‚
â”‚  {                                                               â”‚
â”‚    "name": "TestProject",                                        â”‚
â”‚    "description": "Build a task manager",                        â”‚
â”‚    "project_type": "web_app",                                    â”‚
â”‚    "max_stage": "architecture_design"  â† NEW PARAMETER          â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           workflow.generate_application()                        â”‚
â”‚                                                                   â”‚
â”‚  1. Parse max_stage from config                                 â”‚
â”‚  2. Convert string to WorkflowStage enum                         â”‚
â”‚  3. Create WorkflowExecution with max_stage field                â”‚
â”‚                                                                   â”‚
â”‚  execution = WorkflowExecution(                                  â”‚
â”‚    id=execution_id,                                              â”‚
â”‚    max_stage=WorkflowStage.ARCHITECTURE_DESIGN,  â† SET HERE     â”‚
â”‚    ...                                                           â”‚
â”‚  )                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        _execute_stages_with_parallelism()                        â”‚
â”‚                                                                   â”‚
â”‚  Log: ğŸ¯ Workflow will stop after stage: architecture_design    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Stage Group 1: Critical Analysis              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Stage: REQUIREMENTS_ANALYSIS                      â”‚          â”‚
â”‚  â”‚  âœ… Execute stage                                  â”‚          â”‚
â”‚  â”‚  âœ… Generate: PRD, Data Model, Backlog, Sprint    â”‚          â”‚
â”‚  â”‚  âœ… Mark as completed                              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Stage: ARCHITECTURE_DESIGN                        â”‚          â”‚
â”‚  â”‚  âœ… Execute stage                                  â”‚          â”‚
â”‚  â”‚  âœ… Generate: Architecture diagrams                â”‚          â”‚
â”‚  â”‚  âœ… Mark as completed                              â”‚          â”‚
â”‚  â”‚                                                     â”‚          â”‚
â”‚  â”‚  âš¡ CHECK: Is this stage == max_stage?            â”‚          â”‚
â”‚  â”‚     YES! âœ… Stop workflow                          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Workflow Termination                            â”‚
â”‚                                                                   â”‚
â”‚  1. Set execution.status = COMPLETED                             â”‚
â”‚  2. Set execution.current_stage = COMPLETION                     â”‚
â”‚  3. Broadcast WebSocket event:                                   â”‚
â”‚     "âœ… Workflow completed at max_stage: architecture_design"   â”‚
â”‚  4. Return from _execute_stages_with_parallelism()              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Stage Group 2: Development                    â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Stage: FRONTEND_DEVELOPMENT                       â”‚          â”‚
â”‚  â”‚  â­ï¸  SKIPPED (max_stage reached)                   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Stage: BACKEND_DEVELOPMENT                        â”‚          â”‚
â”‚  â”‚  â­ï¸  SKIPPED (max_stage reached)                   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â­ï¸  All remaining stages (3-5) are skipped

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend Dashboard                          â”‚
â”‚                                                                   â”‚
â”‚  Receives WebSocket events:                                      â”‚
â”‚  - project_progress: 100%                                        â”‚
â”‚  - project_completed                                             â”‚
â”‚  - Status: COMPLETED                                             â”‚
â”‚                                                                   â”‚
â”‚  Displays:                                                       â”‚
â”‚  âœ… Workflow completed at architecture_design stage             â”‚
â”‚  ğŸ“„ Generated artifacts available for download                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Stage Execution Decision Tree

```
For each stage in stage_group:
    â”‚
    â”œâ”€ Is stage == INITIALIZATION?
    â”‚  â””â”€ YES â†’ Skip
    â”‚  â””â”€ NO â†’ Continue
    â”‚
    â”œâ”€ Is max_stage set?
    â”‚  â”‚
    â”‚  â”œâ”€ NO â†’ Execute stage normally
    â”‚  â”‚
    â”‚  â””â”€ YES â†’ Check if max_stage already completed
    â”‚     â”‚
    â”‚     â”œâ”€ max_stage in completed_stages?
    â”‚     â”‚  â”‚
    â”‚     â”‚  â”œâ”€ YES â†’ Stop workflow, return
    â”‚     â”‚  â””â”€ NO â†’ Continue
    â”‚     â”‚
    â”‚     â”œâ”€ Execute current stage
    â”‚     â”‚
    â”‚     â””â”€ After stage completion:
    â”‚        â”‚
    â”‚        â””â”€ Is current_stage == max_stage?
    â”‚           â”‚
    â”‚           â”œâ”€ YES â†’ Stop workflow, mark COMPLETED, return
    â”‚           â””â”€ NO â†’ Continue to next stage
```

## Comparison: With vs Without max_stage

### Without max_stage (Default Behavior)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  All 13 Stages Execute Sequentially      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. INITIALIZATION                       â”‚
â”‚  2. REQUIREMENTS_ANALYSIS               â”‚
â”‚  3. ARCHITECTURE_DESIGN                 â”‚
â”‚  4. FRONTEND_DEVELOPMENT                â”‚
â”‚  5. BACKEND_DEVELOPMENT                 â”‚
â”‚  6. INTEGRATION                         â”‚
â”‚  7. SECURITY_SCANNING                   â”‚
â”‚  8. TESTING                             â”‚
â”‚  9. DEPLOYMENT_SETUP                    â”‚
â”‚  10. GITHUB_DEPLOYMENT                  â”‚
â”‚  11. BACKLOG_PUBLISHING                 â”‚
â”‚  12. VALIDATION                         â”‚
â”‚  13. COMPLETION                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Total Time: ~15 minutes
```

### With max_stage: "architecture_design"
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Only First 2 Stages Execute             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. INITIALIZATION                       â”‚
â”‚  2. REQUIREMENTS_ANALYSIS âœ…             â”‚
â”‚  3. ARCHITECTURE_DESIGN âœ…               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚  WORKFLOW STOPS HERE                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚  4. FRONTEND_DEVELOPMENT â­ï¸              â”‚
â”‚  5. BACKEND_DEVELOPMENT â­ï¸               â”‚
â”‚  6. INTEGRATION â­ï¸                       â”‚
â”‚  7. SECURITY_SCANNING â­ï¸                 â”‚
â”‚  8. TESTING â­ï¸                           â”‚
â”‚  9. DEPLOYMENT_SETUP â­ï¸                  â”‚
â”‚  10. GITHUB_DEPLOYMENT â­ï¸                â”‚
â”‚  11. BACKLOG_PUBLISHING â­ï¸               â”‚
â”‚  12. VALIDATION â­ï¸                       â”‚
â”‚  13. COMPLETION â­ï¸                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Total Time: ~5 minutes
```

## Code Execution Path

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  File: agent_swarms.py (API Endpoint)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  @router.post("/orchestrate")                           â”‚
â”‚  async def create_agent_swarm_project():                â”‚
â”‚      â”‚                                                   â”‚
â”‚      â”œâ”€ Extract max_stage from project_config           â”‚
â”‚      â”‚  max_stage = project_config.get("max_stage")    â”‚
â”‚      â”‚                                                   â”‚
â”‚      â”œâ”€ Pass to workflow.generate_application()         â”‚
â”‚      â”‚  execution_id = await workflow.generate_application(â”‚
â”‚      â”‚      user_prompt,                                â”‚
â”‚      â”‚      {                                            â”‚
â”‚      â”‚          "project_id": project_id,               â”‚
â”‚      â”‚          "max_stage": max_stage  â† PASSED HERE  â”‚
â”‚      â”‚      }                                            â”‚
â”‚      â”‚  )                                                â”‚
â”‚      â”‚                                                   â”‚
â”‚      â””â”€ Return project_id                               â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  File: application_workflow.py                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  async def generate_application(config):                â”‚
â”‚      â”‚                                                   â”‚
â”‚      â”œâ”€ Parse max_stage from config                     â”‚
â”‚      â”‚  max_stage_str = config.get('max_stage')        â”‚
â”‚      â”‚  max_stage = WorkflowStage(max_stage_str)       â”‚
â”‚      â”‚                                                   â”‚
â”‚      â”œâ”€ Create WorkflowExecution                        â”‚
â”‚      â”‚  execution = WorkflowExecution(                  â”‚
â”‚      â”‚      id=execution_id,                            â”‚
â”‚      â”‚      max_stage=max_stage  â† STORED HERE         â”‚
â”‚      â”‚  )                                                â”‚
â”‚      â”‚                                                   â”‚
â”‚      â””â”€ Start workflow in background                    â”‚
â”‚         asyncio.create_task(_execute_workflow())        â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  async def _execute_stages_with_parallelism():          â”‚
â”‚      â”‚                                                   â”‚
â”‚      â”œâ”€ Log max_stage if set                            â”‚
â”‚      â”‚  logger.info(f"ğŸ¯ Will stop at: {max_stage}")   â”‚
â”‚      â”‚                                                   â”‚
â”‚      â”œâ”€ FOR each stage_group:                           â”‚
â”‚      â”‚   â”‚                                               â”‚
â”‚      â”‚   â””â”€ FOR each stage in stages:                   â”‚
â”‚      â”‚       â”‚                                           â”‚
â”‚      â”‚       â”œâ”€ Check if max_stage reached (BEFORE)     â”‚
â”‚      â”‚       â”‚  if max_stage in completed:              â”‚
â”‚      â”‚       â”‚      return  # Stop workflow             â”‚
â”‚      â”‚       â”‚                                           â”‚
â”‚      â”‚       â”œâ”€ Execute stage                           â”‚
â”‚      â”‚       â”‚  await _execute_stage(stage)             â”‚
â”‚      â”‚       â”‚                                           â”‚
â”‚      â”‚       â””â”€ Check if max_stage reached (AFTER)      â”‚
â”‚      â”‚          if stage == max_stage:                  â”‚
â”‚      â”‚              execution.status = COMPLETED        â”‚
â”‚      â”‚              return  # Stop workflow             â”‚
â”‚      â”‚                                                   â”‚
â”‚      â””â”€ All stages completed or max_stage reached       â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## WebSocket Event Flow

```
Timeline when max_stage = "architecture_design":

T+0s    â”‚ ğŸš€ Starting agent swarm workflow
        â”‚ WebSocket: project_started
        â”‚
T+10s   â”‚ ğŸ“Š Executing: requirements_analysis
        â”‚ WebSocket: workflow_stage("requirements_analysis")
        â”‚
T+120s  â”‚ âœ… Completed: requirements_analysis
        â”‚ WebSocket: project_progress(25%)
        â”‚
T+130s  â”‚ ğŸ“Š Executing: architecture_design
        â”‚ WebSocket: workflow_stage("architecture_design")
        â”‚
T+300s  â”‚ âœ… Completed: architecture_design
        â”‚ WebSocket: project_progress(50%)
        â”‚
T+301s  â”‚ âœ… Reached max_stage: architecture_design
        â”‚ WebSocket: workflow_log("âœ… Workflow completed at max_stage")
        â”‚ WebSocket: project_completed(preview_url)
        â”‚
        â”‚ â¹ï¸  Workflow terminates
        â”‚ Status: COMPLETED
        â”‚
        â”‚ â­ï¸  Skipped stages 4-13
```

---

**Visual Guide Version**: 1.0
**Last Updated**: December 9, 2025
**Diagrams**: ASCII Art for terminal compatibility
