import { Pool, PoolConfig, PoolClient } from "pg";
import { IsolationLevel, TransactionConfig } from "./transaction";
import { ValuesOf } from "./utils";
import { Knex } from "knex";
export interface UserDatabase {
    init(debugMode?: boolean): Promise<void>;
    destroy(): Promise<void>;
    getName(): UserDatabaseName;
    transaction<R, T extends unknown[]>(transactionFunction: UserDatabaseTransaction<R, T>, config: TransactionConfig, ...args: T): Promise<R>;
    queryFunction<C extends UserDatabaseClient, R, T extends unknown[]>(queryFunction: UserDatabaseQuery<C, R, T>, ...params: T): Promise<R>;
    query<R, T extends unknown[]>(sql: string, ...params: T): Promise<R[]>;
    queryWithClient<R, T extends unknown[] = unknown[]>(client: UserDatabaseClient, sql: string, ...params: T): Promise<R[]>;
    isRetriableTransactionError(error: unknown): boolean;
    isKeyConflictError(error: unknown): boolean;
    isFailedSqlTransactionError(error: unknown): boolean;
    createSchema(): Promise<void>;
    dropSchema(): Promise<void>;
}
type UserDatabaseQuery<C extends UserDatabaseClient, R, T extends unknown[]> = (ctxt: C, ...args: T) => Promise<R>;
type UserDatabaseTransaction<R, T extends unknown[]> = (ctxt: UserDatabaseClient, ...args: T) => Promise<R>;
export type UserDatabaseClient = PoolClient | PrismaClient | TypeORMEntityManager | Knex | DrizzleClient;
export declare const UserDatabaseName: {
    readonly PGNODE: "pg-node";
    readonly PRISMA: "prisma";
    readonly TYPEORM: "typeorm";
    readonly KNEX: "knex";
    readonly DRIZZLE: "drizzle";
};
export type UserDatabaseName = ValuesOf<typeof UserDatabaseName>;
export declare const schemaExistsQuery = "SELECT EXISTS (SELECT FROM information_schema.schemata WHERE schema_name = 'dbos')";
export declare const txnOutputTableExistsQuery = "SELECT EXISTS (SELECT FROM information_schema.tables WHERE table_schema = 'dbos' AND table_name = 'transaction_outputs')";
export declare const txnOutputIndexExistsQuery = "SELECT EXISTS (SELECT FROM pg_indexes WHERE schemaname='dbos' AND tablename = 'transaction_outputs' AND indexname = 'transaction_outputs_created_at_index')";
export declare function pgNodeIsKeyConflictError(error: unknown): boolean;
/**
 * node-postgres user data access interface
 */
export declare class PGNodeUserDatabase implements UserDatabase {
    readonly poolConfig: PoolConfig;
    readonly pool: Pool;
    constructor(poolConfig: PoolConfig);
    init(debugMode?: boolean): Promise<void>;
    destroy(): Promise<void>;
    getName(): "pg-node";
    transaction<R, T extends unknown[]>(txn: UserDatabaseTransaction<R, T>, config: TransactionConfig, ...args: T): Promise<R>;
    queryFunction<C extends UserDatabaseClient, R, T extends unknown[]>(func: UserDatabaseQuery<C, R, T>, ...args: T): Promise<R>;
    query<R, T extends unknown[]>(sql: string, ...params: T): Promise<R[]>;
    queryWithClient<R, T extends unknown[]>(client: UserDatabaseClient, sql: string, ...params: T): Promise<R[]>;
    getPostgresErrorCode(error: unknown): string | null;
    isRetriableTransactionError(error: unknown): boolean;
    isKeyConflictError(error: unknown): boolean;
    isFailedSqlTransactionError(error: unknown): boolean;
    createSchema(): Promise<void>;
    dropSchema(): Promise<void>;
}
/**
 * Prisma user data access interface
 */
export interface PrismaClient {
    $queryRawUnsafe<R, T extends unknown[]>(query: string, ...params: T): Promise<R[]>;
    $transaction<R>(fn: (prisma: unknown) => Promise<R>, options?: {
        maxWait?: number;
        timeout?: number;
        isolationLevel?: unknown;
    }): Promise<R>;
    $disconnect(): Promise<void>;
}
export declare class PrismaUserDatabase implements UserDatabase {
    readonly prisma: PrismaClient;
    constructor(prisma: PrismaClient);
    init(debugMode?: boolean): Promise<void>;
    destroy(): Promise<void>;
    getName(): "prisma";
    transaction<R, T extends unknown[]>(transaction: UserDatabaseTransaction<R, T>, config: TransactionConfig, ...args: T): Promise<R>;
    queryFunction<C extends UserDatabaseClient, R, T extends unknown[]>(func: UserDatabaseQuery<C, R, T>, ...args: T): Promise<R>;
    query<R, T extends unknown[]>(sql: string, ...params: T): Promise<R[]>;
    queryWithClient<R, T extends unknown[]>(client: UserDatabaseClient, sql: string, ...params: T): Promise<R[]>;
    getPostgresErrorCode(error: unknown): string | null;
    isRetriableTransactionError(error: unknown): boolean;
    isKeyConflictError(error: unknown): boolean;
    isFailedSqlTransactionError(error: unknown): boolean;
    createSchema(): Promise<void>;
    dropSchema(): Promise<void>;
}
interface TypeORMDataSource {
    readonly isInitialized: boolean;
    readonly manager: TypeORMEntityManager;
    initialize(): Promise<this>;
    query<R = unknown>(query: string): Promise<R>;
    destroy(): Promise<void>;
    synchronize(): Promise<void>;
    dropDatabase(): Promise<void>;
}
export interface TypeORMEntityManager {
    query<R, T extends unknown[]>(query: string, parameters?: T): Promise<R>;
    transaction<R>(isolationLevel: IsolationLevel, runinTransaction: (entityManager: TypeORMEntityManager) => Promise<R>): Promise<R>;
}
/**
 * TypeORM user data access interface
 */
export declare class TypeORMDatabase implements UserDatabase {
    readonly ds: TypeORMDataSource;
    readonly dataSource: TypeORMDataSource;
    constructor(ds: TypeORMDataSource);
    init(debugMode?: boolean): Promise<void>;
    destroy(): Promise<void>;
    getName(): "typeorm";
    transaction<R, T extends unknown[]>(txn: UserDatabaseTransaction<R, T>, config: TransactionConfig, ...args: T): Promise<R>;
    queryFunction<C extends UserDatabaseClient, R, T extends unknown[]>(func: UserDatabaseQuery<C, R, T>, ...args: T): Promise<R>;
    query<R>(sql: string, ...params: unknown[]): Promise<R[]>;
    queryWithClient<R, T extends unknown[]>(client: UserDatabaseClient, sql: string, ...params: T): Promise<R[]>;
    getPostgresErrorCode(error: unknown): string | null;
    isRetriableTransactionError(error: unknown): boolean;
    isKeyConflictError(error: unknown): boolean;
    isFailedSqlTransactionError(error: unknown): boolean;
    createSchema(): Promise<void>;
    dropSchema(): Promise<void>;
}
/**
 * Knex user data access interface
 */
export declare class KnexUserDatabase implements UserDatabase {
    readonly knex: Knex;
    constructor(knex: Knex);
    init(debugMode?: boolean): Promise<void>;
    destroy(): Promise<void>;
    getName(): "knex";
    transaction<R, T extends unknown[]>(transactionFunction: UserDatabaseTransaction<R, T>, config: TransactionConfig, ...args: T): Promise<R>;
    queryFunction<C extends UserDatabaseClient, R, T extends unknown[]>(func: UserDatabaseQuery<C, R, T>, ...args: T): Promise<R>;
    query<R, T extends unknown[]>(sql: string, ...params: T): Promise<R[]>;
    queryWithClient<R, T extends unknown[]>(client: Knex, sql: string, ...uparams: T): Promise<R[]>;
    getPostgresErrorCode(error: unknown): string | null;
    isRetriableTransactionError(error: unknown): boolean;
    isKeyConflictError(error: unknown): boolean;
    isFailedSqlTransactionError(error: unknown): boolean;
    createSchema(): Promise<void>;
    dropSchema(): Promise<void>;
}
export interface DrizzleClient {
    select(): unknown;
    selectDistinct(): unknown;
    update(table: unknown): unknown;
    insert(table: unknown): unknown;
    delete(table: unknown): unknown;
    execute(query: unknown): unknown;
    _: {
        session: any;
    };
    transaction<R>(fn: (tx: any) => Promise<R>, options: {
        isolationLevel: any;
        accessMode: any;
    }): Promise<R>;
}
/**
 * Drizzle user data access interface
 */
export declare class DrizzleUserDatabase implements UserDatabase {
    readonly pool: Pool;
    readonly db: DrizzleClient;
    constructor(pool: Pool, db: DrizzleClient);
    init(debugMode?: boolean): Promise<void>;
    destroy(): Promise<void>;
    getName(): "drizzle";
    transaction<R, T extends unknown[]>(transactionFunction: UserDatabaseTransaction<R, T>, config: TransactionConfig, ...args: T): Promise<R>;
    queryFunction<C extends UserDatabaseClient, R, T extends unknown[]>(func: UserDatabaseQuery<C, R, T>, ...args: T): Promise<R>;
    query<R, T extends unknown[]>(sql: string, ...params: T): Promise<R[]>;
    queryWithClient<R, T extends unknown[]>(client: DrizzleClient, sqlString: string, ...params: T): Promise<R[]>;
    getPostgresErrorCode(error: unknown): string | null;
    isRetriableTransactionError(error: unknown): boolean;
    isKeyConflictError(error: unknown): boolean;
    isFailedSqlTransactionError(error: unknown): boolean;
    createSchema(): Promise<void>;
    dropSchema(): Promise<void>;
}
export {};
//# sourceMappingURL=user_database.d.ts.map