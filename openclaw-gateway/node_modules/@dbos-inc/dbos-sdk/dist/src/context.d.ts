/// <reference types="node" />
/// <reference types="node" />
/// <reference types="node" />
/// <reference types="node/http" />
import { Span } from "@opentelemetry/sdk-trace-base";
import { GlobalLogger as Logger, Logger as DBOSLogger } from "./telemetry/logs";
import { IncomingHttpHeaders } from "http";
import { ParsedUrlQuery } from "querystring";
import { UserDatabaseClient } from "./user_database";
import { DBOSExecutor } from "./dbos-executor";
import { AsyncLocalStorage } from "async_hooks";
import { WorkflowContext, WorkflowContextImpl } from "./workflow";
import { TransactionContextImpl } from "./transaction";
import { StepContextImpl } from "./step";
import { HandlerContextImpl } from "./httpServer/handler";
export interface DBOSLocalCtx {
    ctx?: DBOSContext;
    parentCtx?: DBOSLocalCtx;
    idAssignedForNextWorkflow?: string;
    queueAssignedForWorkflows?: string;
    workflowId?: string;
    functionId?: number;
    inRecovery?: boolean;
    curStepFunctionId?: number;
    curTxFunctionId?: number;
    sqlClient?: UserDatabaseClient;
    span?: Span;
    authenticatedUser?: string;
    authenticatedRoles?: string[];
    assumedRole?: string;
    request?: HTTPRequest;
    operationType?: string;
    operationCaller?: string;
}
export declare const asyncLocalCtx: AsyncLocalStorage<DBOSLocalCtx>;
export declare function getCurrentContextStore(): DBOSLocalCtx | undefined;
export declare function getCurrentDBOSContext(): DBOSContext | undefined;
export declare function assertCurrentDBOSContext(): DBOSContext;
export declare function assertCurrentWorkflowContext(): WorkflowContextImpl;
export declare function getNextWFID(assignedID?: string): string | undefined;
export declare function runWithDBOSContext<R>(ctx: DBOSContext, callback: () => Promise<R>): Promise<R>;
export declare function runWithHandlerContext<R>(ctx: HandlerContextImpl, callback: () => Promise<R>): Promise<R>;
export declare function runWithTopContext<R>(ctx: DBOSLocalCtx, callback: () => Promise<R>): Promise<R>;
export declare function runWithTransactionContext<Client extends UserDatabaseClient, R>(ctx: TransactionContextImpl<Client>, callback: () => Promise<R>): Promise<R>;
export declare function runWithStepContext<R>(ctx: StepContextImpl, callback: () => Promise<R>): Promise<R>;
export declare function runWithWorkflowContext<R>(ctx: WorkflowContext, callback: () => Promise<R>): Promise<R>;
export interface HTTPRequest {
    readonly headers?: IncomingHttpHeaders;
    readonly rawHeaders?: string[];
    readonly params?: unknown;
    readonly body?: unknown;
    readonly rawBody?: string;
    readonly query?: ParsedUrlQuery;
    readonly querystring?: string;
    readonly url?: string;
    readonly method?: string;
    readonly ip?: string;
    readonly requestID?: string;
}
export interface DBOSContext {
    readonly request: HTTPRequest;
    readonly workflowUUID: string;
    readonly authenticatedUser: string;
    readonly authenticatedRoles: string[];
    readonly assumedRole: string;
    readonly logger: DBOSLogger;
    readonly span: Span;
    getConfig<T>(key: string): T | undefined;
    getConfig<T>(key: string, defaultValue: T): T;
}
export declare class DBOSContextImpl implements DBOSContext {
    readonly operationName: string;
    readonly span: Span;
    request: HTTPRequest;
    authenticatedUser: string;
    authenticatedRoles: string[];
    assumedRole: string;
    workflowUUID: string;
    executorID: string;
    applicationVersion: string;
    applicationID: string;
    readonly logger: DBOSLogger;
    constructor(operationName: string, span: Span, logger: Logger, parentCtx?: DBOSContextImpl);
    /*** Application configuration ***/
    applicationConfig?: object;
    getConfig<T>(key: string): T | undefined;
    getConfig<T>(key: string, defaultValue: T): T;
}
/**
 * TODO : move logger and application, getConfig to a BaseContext which is at the root of all contexts
 */
export declare class InitContext {
    readonly dbosExec: DBOSExecutor;
    readonly logger: Logger;
    private userDatabase;
    private application?;
    constructor(dbosExec: DBOSExecutor);
    createUserSchema(): Promise<void>;
    dropUserSchema(): Promise<void>;
    queryUserDB<R>(sql: string, ...params: unknown[]): Promise<R[]>;
    getConfig<T>(key: string): T | undefined;
    getConfig<T>(key: string, defaultValue: T): T;
}
//# sourceMappingURL=context.d.ts.map